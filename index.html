<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Khoa Công nghệ Thông tin - Trường ĐH KHTN | Infographics</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700;900&family=Poppins:wght@700;900&display=swap"
		rel="stylesheet">
	<script src="https://unpkg.com/lucide@latest"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
	<style>
		body {
			font-family: 'Be Vietnam Pro', sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: #1E293B;
			min-height: 100vh;
			overflow: hidden;
		}

		.main-container {
			background-color: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 1rem;
			box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
		}

		.content-container {
			background-color: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 1rem;
			box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
			max-height: calc(100vh - 2rem);
			overflow: hidden;
		}

		.menu-item {
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
			border: 2px solid #e2e8f0;
			transition: all 0.3s ease;
			border-radius: 1rem;
			cursor: pointer;
		}

		.menu-item:hover {
			transform: translateY(-5px);
			border-color: #3b82f6;
			box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
		}

		.menu-item.active {
			border-color: #3b82f6;
			background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
		}

		.content-frame {
			border: none;
			border-radius: 1rem;
			box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
			background-color: white;
			overflow: hidden;
			position: relative;
		}

		.sidebar-container {
			min-height: 600px;
			max-height: calc(100vh - 2rem);
			overflow-y: auto;
		}

		.content-frame {
			height: calc(100vh - 4rem) !important;
			max-height: calc(100vh - 4rem) !important;
		}

		.header-section {
			background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
			color: white;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
		}

		.download-buttons {
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 1000;
			display: flex;
			flex-direction: column;
			gap: 10px;
		}

		.download-btn {
			backdrop-filter: blur(10px);
			background: rgba(59, 130, 246, 0.9);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.download-btn:hover {
			background: rgba(37, 99, 235, 0.95);
			transform: translateY(-2px);
		}

		.progress-container {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 2000;
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			padding: 2rem;
			border-radius: 1rem;
			box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
			display: none;
		}

		.menu-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
			gap: 1rem;
		}

		@media (max-width: 1024px) {
			.download-buttons {
				top: 10px;
				right: 10px;
				gap: 8px;
			}
		}

		.icon-color-ai {
			color: #4f46e5;
		}

		.icon-color-cs {
			color: #111B88;
		}

		.icon-color-cv {
			color: #65a30d;
		}

		.icon-color-ds {
			color: #e11d48;
		}

		.icon-color-is {
			color: #0891b2;
		}

		.icon-color-ke {
			color: #d97706;
		}

		.icon-color-cn {
			color: #ea580c;
		}

		.icon-color-se {
			color: #2563eb;
		}

		.icon-color-faculty {
			color: #7c3aed;
		}

		/* Export Mode CSS - Center align page content */
		.export-mode {
			width: 1096px !important;
			height: auto !important;
			max-width: none !important;
			padding: 0 !important;
			margin: 0 auto !important;
			background: white !important;
			overflow: visible !important;
			display: flex !important;
			justify-content: center !important;
			align-items: flex-start !important;
		}

		.export-mode .container {
			padding: 20px !important;
			margin: 0 auto !important;
		}

		.export-mode .header-section {
			padding: 60px 24px !important;
			margin: 0 auto 32px auto !important;
			text-align: center !important;
		}

		.export-mode .header-section h1 {
			font-size: 4rem !important;
			text-align: center !important;
		}

		/* Export Mode - Fixed Image Dimensions */
		.export-mode img {
			max-width: 100% !important;
			height: auto !important;
			object-fit: contain !important;
			object-position: center !important;
			background-color: transparent !important;
			display: block !important;
			margin: 0 auto !important;
			border: none !important;
			box-shadow: none !important;
		}

		/* Standard image containers in export mode */
		.export-mode .card img {
			width: 100% !important;
			height: 250px !important;
			object-fit: contain !important;
			object-position: center !important;
			border-radius: 0.5rem !important;
			background-color: rgba(248, 250, 252, 0.5) !important;
		}

		/* Overflow hidden containers - prevent image distortion */
		.export-mode .card.overflow-hidden {
			overflow: visible !important;
		}

		.export-mode .card.overflow-hidden img {
			height: 300px !important;
			object-fit: contain !important;
			object-position: center !important;
		}

		/* Specific fixes for placeholder images with different aspect ratios */
		.export-mode img[src*="placehold.co"] {
			background-color: rgba(248, 250, 252, 0.8) !important;
			border: 1px solid rgba(226, 232, 240, 0.5) !important;
		}

		/* Wide images (3:2 aspect ratio like 600x400) */
		.export-mode img[src*="600x400"] {
			width: 100% !important;
			height: 200px !important;
			max-height: 200px !important;
		}

		/* Square-ish images (4:3 aspect ratio like 800x600) */
		.export-mode img[src*="800x600"] {
			width: 100% !important;
			height: 240px !important;
			max-height: 240px !important;
		}

		/* Tall images (4:5 aspect ratio like 800x1000) */
		.export-mode img[src*="800x1000"] {
			width: 100% !important;
			height: 300px !important;
			max-height: 300px !important;
		}

		/* Force consistent sizing regardless of source dimensions */
		.export-mode .grid img,
		.export-mode .space-y-6 img,
		.export-mode .items-center img {
			object-fit: contain !important;
			object-position: center !important;
			background-color: rgba(248, 250, 252, 0.3) !important;
		}

		/* Responsive adjustments for mobile */
		@media (max-width: 768px) {
			body:not(.export-mode) .main-container {
				padding: 1rem !important;
			}

			body:not(.export-mode) .content-container {
				padding: 1rem !important;
			}
		}

		/* Enhanced responsive design */
		@media (max-width: 1024px) {
			body:not(.export-mode) .container {
				padding: 1rem !important;
			}

			body:not(.export-mode) .menu-grid {
				grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important;
				gap: 0.75rem !important;
			}

			body:not(.export-mode) .header-section {
				padding: 2rem 1rem !important;
			}

			body:not(.export-mode) .header-section h1 {
				font-size: 2rem !important;
			}
		}

		@media (max-width: 640px) {
			body:not(.export-mode) .menu-grid {
				grid-template-columns: 1fr !important;
				gap: 0.5rem !important;
			}

			body:not(.export-mode) .menu-item {
				padding: 0.75rem !important;
			}

			body:not(.export-mode) .header-section {
				padding: 1.5rem 0.75rem !important;
			}

			body:not(.export-mode) .header-section h1 {
				font-size: 1.5rem !important;
			}

			body:not(.export-mode) .download-buttons {
				top: 8px !important;
				right: 8px !important;
				gap: 6px !important;
			}

			body:not(.export-mode) .download-btn {
				padding: 0.5rem 0.75rem !important;
				font-size: 0.875rem !important;
			}

			body:not(.export-mode) .download-btn span {
				display: none !important;
			}
		}
	</style>
</head>

<body class="antialiased">
	<div class="download-buttons">
		<button id="download-current"
			class="download-btn text-white font-bold py-3 px-4 rounded-full shadow-lg flex items-center gap-2 transition-all duration-300">
			<i data-lucide="download" class="w-5 h-5"></i>
			<span>Tải trang hiện tại</span>
		</button>
		<button id="download-all"
			class="download-btn text-white font-bold py-3 px-4 rounded-full shadow-lg flex items-center gap-2 transition-all duration-300">
			<i data-lucide="download-cloud" class="w-5 h-5"></i>
			<span>Tải tất cả PNG</span>
		</button>
	</div>

	<div id="progress-modal" class="progress-container">
		<div class="text-center">
			<div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
			<h3 class="text-lg font-semibold mb-2">Đang tạo file PNG...</h3>
			<p id="progress-text" class="text-gray-600 mb-4">Chuẩn bị tải...</p>
			<div class="w-full bg-gray-200 rounded-full h-2">
				<div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
			</div>
		</div>
	</div>

	<div class="container mx-auto p-2 md:p-4 lg:p-8">
		<div class="grid lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-1 gap-4 md:gap-8">
			<div class="lg:col-span-1 md:col-span-1">
				<div id="sidebar-container" class="main-container sidebar-container p-4 md:p-6 lg:sticky lg:top-4">
					<h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 md:mb-6 text-center">
						<i data-lucide="navigation" class="inline w-5 h-5 md:w-6 md:h-6 mr-2"></i>
						<span>Danh sách chuyên ngành</span>
					</h2>
					<div class="space-y-3">
						<div class="menu-item p-4 text-center" onclick="loadContent('faculty.html', this)">
							<i data-lucide="graduation-cap" class="w-8 h-8 mx-auto mb-2 icon-color-faculty"></i>
							<h3 class="font-bold text-sm">Thông tin chung</h3>
							<p class="text-xs text-gray-600">Khoa CNTT</p>
						</div>

						<div class="menu-item p-4 text-center" onclick="window.open('filter.html', '_blank')">
							<i data-lucide="filter" class="w-8 h-8 mx-auto mb-2" style="color: #7c2d12;"></i>
							<h3 class="font-bold text-sm">Mô phỏng lọc ảo</h3>
							<p class="text-xs text-gray-600">Quy trình xét tuyển</p>
						</div>

						<div class="menu-item p-4 text-center active" onclick="loadContent('pages/computer_science.html', this)">
							<i data-lucide="cpu" class="w-8 h-8 mx-auto mb-2 icon-color-cs"></i>
							<h3 class="font-bold text-sm">Khoa học Máy tính</h3>
							<p class="text-xs text-gray-600">KHMT - Computer Science</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/artificial_intelligence.html', this)">
							<i data-lucide="brain-circuit" class="w-8 h-8 mx-auto mb-2 icon-color-ai"></i>
							<h3 class="font-bold text-sm">Trí tuệ Nhân tạo</h3>
							<p class="text-xs text-gray-600">TTNT - Artificial Intelligence</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/computer_vision.html', this)">
							<i data-lucide="camera" class="w-8 h-8 mx-auto mb-2 icon-color-cv"></i>
							<h3 class="font-bold text-sm">Thị Giác Máy Tính & Điều Khiển Học Thông Minh</h3>
							<p class="text-xs text-gray-600">Computer Vision & Cognitive Cybernetics</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/knowledge_engineer.html', this)">
							<i data-lucide="book-open" class="w-8 h-8 mx-auto mb-2 icon-color-ke"></i>
							<h3 class="font-bold text-sm">Công nghệ Tri thức</h3>
							<p class="text-xs text-gray-600">CNTThuc - Knowledge Engineering</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/data_science.html', this)">
							<i data-lucide="bar-chart-3" class="w-8 h-8 mx-auto mb-2 icon-color-ds"></i>
							<h3 class="font-bold text-sm">Khoa học Dữ liệu</h3>
							<p class="text-xs text-gray-600">KHDL - Data Science</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/software_engineer.html', this)">
							<i data-lucide="code" class="w-8 h-8 mx-auto mb-2 icon-color-se"></i>
							<h3 class="font-bold text-sm">Kỹ thuật Phần mềm</h3>
							<p class="text-xs text-gray-600">KTPM - Software Engineering</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/computer_network.html', this)">
							<i data-lucide="network" class="w-8 h-8 mx-auto mb-2 icon-color-cn"></i>
							<h3 class="font-bold text-sm">Mạng máy tính & Viễn thông</h3>
							<p class="text-xs text-gray-600">MMT - Computer Network</p>
						</div>
						<div class="menu-item p-4 text-center" onclick="loadContent('pages/information_system.html', this)">
							<i data-lucide="database" class="w-8 h-8 mx-auto mb-2 icon-color-is"></i>
							<h3 class="font-bold text-sm">Hệ thống Thông tin</h3>
							<p class="text-xs text-gray-600">HTTT - Information System</p>
						</div>
					</div>
				</div>
			</div>

			<div class="lg:col-span-3 md:col-span-2">
				<div class="content-container p-2 md:p-4">
					<iframe id="content-frame" class="content-frame w-full" src="pages/computer_science.html" frameborder="0">
					</iframe>
				</div>
			</div>
		</div>
	</div>

	<script>
		lucide.createIcons();

		let currentPageUrl = 'pages/computer_science.html';

		const pageConfigs = {
			'faculty.html': { background: '#F8FAFC', filename: 'thongtin-chung-fit-hcmus.png' },
			'pages/artificial_intelligence.html': { background: '#EEF2FF', filename: 'infographic-ai-hcmus.png' },
			'pages/computer_science.html': { background: '#F8FAFC', filename: 'infographic-khmt-hcmus.png' },
			'pages/computer_vision.html': { background: '#F7FEE7', filename: 'infographic-thigiacmaytinh-hcmus.png' },
			'pages/data_science.html': { background: '#FFF1F2', filename: 'infographic-khdl-hcmus.png' },
			'pages/information_system.html': { background: '#ECFEFF', filename: 'infographic-httt-hcmus.png' },
			'pages/knowledge_engineer.html': { background: '#FAF5FF', filename: 'infographic-cntt-hcmus.png' },
			'pages/computer_network.html': { background: '#F0FDFA', filename: 'infographic-mmt-hcmus.png' },
			'pages/software_engineer.html': { background: '#EFF6FF', filename: 'infographic-ktpm-hcmus.png' }
		};

		function loadContent(url, element) {
			currentPageUrl = url;
			document.getElementById('content-frame').src = url;
			document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
			element.classList.add('active');
		}

		// --- Chức năng xuất PNG ---

		// Hàm chung để chụp ảnh màn hình một trang
		async function capturePageAsCanvas(url, config) {
			return new Promise((resolve, reject) => {
				const tempFrame = document.createElement('iframe');
				// Đặt iframe ra ngoài màn hình để không ảnh hưởng đến người dùng
				Object.assign(tempFrame.style, {
					position: 'absolute',
					left: '-9999px',
					width: '1096px', // Chiều rộng cố định để đảm bảo layout nhất quán
					height: '1200px', // Chiều cao đủ lớn
					border: 'none'
				});
				tempFrame.src = url;
				document.body.appendChild(tempFrame);

				tempFrame.onload = () => {
					try {
						const iframeDoc = tempFrame.contentDocument || tempFrame.contentWindow.document;
						const content = iframeDoc.getElementById('infographic-content');
						if (!content) return reject(new Error('Không tìm thấy nội dung để xuất file'));

						// Thêm class đặc biệt để tối ưu CSS cho việc xuất file
						iframeDoc.body.classList.add('export-mode');

						// Đợi một chút để layout ổn định
						setTimeout(() => {
							html2canvas(content, {
								backgroundColor: config.background,
								useCORS: true,
								scale: 3, // Tăng scale để ảnh nét hơn (gấp 3 lần độ phân giải)
								scrollX: 0,
								scrollY: 0,
								width: 1096, // Đảm bảo chiều rộng canvas đúng với layout
								windowWidth: 1096,
							}).then(canvas => {
								document.body.removeChild(tempFrame);
								resolve(canvas);
							}).catch(reject);
						}, 500);

					} catch (err) {
						document.body.removeChild(tempFrame);
						reject(err);
					}
				};

				tempFrame.onerror = () => {
					document.body.removeChild(tempFrame);
					reject(new Error('Không thể tải trang'));
				};
			});
		}

		// Xử lý nút "Tải trang hiện tại"
		document.getElementById('download-current').addEventListener('click', async () => {
			const config = pageConfigs[currentPageUrl];
			if (!config) return alert('Không thể tải trang này');

			showProgress('Đang tạo file PNG...', 50);
			try {
				const canvas = await capturePageAsCanvas(currentPageUrl, config);
				canvas.toBlob(blob => {
					saveAs(blob, config.filename);
					hideProgress();
				});
			} catch (error) {
				console.error('Lỗi khi tạo PNG:', error);
				alert('Có lỗi xảy ra khi tạo file PNG');
				hideProgress();
			}
		});

		// Xử lý nút "Tải tất cả"
		document.getElementById('download-all').addEventListener('click', async () => {
			const zip = new JSZip();
			const totalPages = Object.keys(pageConfigs).length;
			let completedPages = 0;

			showProgress('Bắt đầu tạo tất cả file PNG...', 0);

			try {
				for (const [url, config] of Object.entries(pageConfigs)) {
					completedPages++;
					updateProgress(`Đang xử lý: ${config.filename} (${completedPages}/${totalPages})`, (completedPages / totalPages) * 100);

					const canvas = await capturePageAsCanvas(url, config);
					const blob = await new Promise(resolve => canvas.toBlob(resolve));
					zip.file(config.filename, blob);
				}

				updateProgress('Đang nén và chuẩn bị tải xuống...', 95);
				const content = await zip.generateAsync({ type: 'blob' });
				saveAs(content, 'fit-hcmus-infographics-all.zip');

				updateProgress('Hoàn tất!', 100);
				setTimeout(hideProgress, 1000);

			} catch (error) {
				console.error('Lỗi khi tạo file ZIP:', error);
				alert('Có lỗi xảy ra khi tạo file ZIP');
				hideProgress();
			}
		});

		// Các hàm quản lý giao diện tiến trình
		function showProgress(text, progress) {
			document.getElementById('progress-modal').style.display = 'block';
			updateProgress(text, progress);
		}

		function updateProgress(text, progress) {
			document.getElementById('progress-text').textContent = text;
			document.getElementById('progress-bar').style.width = progress + '%';
		}

		function hideProgress() {
			document.getElementById('progress-modal').style.display = 'none';
		}
	</script>
</body>

</html>